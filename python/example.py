
import numpy
import changepoint

data = numpy.array([
      8.,  31.,  27.,  33.,  15.,  25.,  45.,  21.,  31.,
      6.,  22.,  20.,  13.,  23.,  30.,   6.,  14.,  15.,
    153.,  35.,  21.,  33.,   8.,  43.,  39.,  51.,  43.,
     27.,  13.,  30.,  90.,  59.,  43.,  46.,  49., 119.,
     79.,  35.,  18.,  65.,  61.,  55.,  48.,  16.,  35.,
     28.,  21.,  20.,  33.,  23.,  22.,  27.,  12.,  26.,
     29.,  26.,  11.,  10.,  25.,  25.,  14.,  18.,  29.,
     11.,  25.,  41.,  29.,  18.,  33.,  39.,  17.,   6.,
     17.,  16.,  14.,  56.,  18.,  21.,  11.,  32.,  28.,
     25.,  34.,  21.,   9.,  14.,  27.,  20.,  79.,  23.,
     25.,  10.,  46.,  59.,  34.,  18.,  17.,  28.,  11.,
     26.,  19.,  17.,  23.,  24.,  20.,  15.,   6.,  20.,
     40.,  52.,  16.,  47.,  14.,  15.,  18.,  37.,  28.,
     11.,  13.,  41.,  38.,  31.,  31.,  86.,  58.,  81.,
     54.,  66.,  77., 114.,  85.,  99.,  64.,  69.,  73.,
     63.,  82.,  65.,  77.,  55.,  50.,  71.,  47.,  48.,
     40.,  22.,  39.,  26.,  47.,  70.,  36.,  42.,  38.,
     65.,  37.,  57.,  77.,  66.,  42.,  48.,  34.,  49.,
     47.,  50.,  53.,  73.,  54.,  41.,  50.,  41., 106.,
     51.,  37.,  33.,  30.,  27.,  40.,  33.,  42.,  46.,
     31.,  27.,  26.,  43.,  37.,  61.,  44.,  39.,  39.,
     33.,  38., 100.,  64.,  55.,  46.,  36.,  25.,  33.,
     42.,  39.,  63.,  71.,  60.,  22.,  45.,  59.,  43.,
     37.,  48.,  32.,  37.,  38.,  41.,  48.,  45.,  34.,
     36.,  22.,  39.,  36.,  36.,  32.,  45.,  38.,  55.,
     39.,  55.,  52.,  35.,  70.,  30.,  53.,  48.,  46.,
     44.,  50.,  28.,  45.,  35.,  39.,  64.,  64.,  23.,
     63.,  70.,  38.,  30.,  35.,  26.,  49., 102., 151.,
     74., 310.,  24.,  21.,  24.,  21.,  19.,  25.,   8.,
    105.,  34.,  20., 119.,  36.,  16.,  50.,  49.,  45.,
     44.,  24.,  32.,  79.,  39.,  51.,  23.,  23.,  60.,
     15.,  24.,  14.,  33.,  37.,  30.,  57.,  17.,  24.,
     21.,  32.,  23.,  22.,  27.,  21.,  34.,  28.,  38.,
     48.,  39.,  26.,  11.,  24.,  11.,  31.,  20.,  28.,
     25.,  54.,  11.,  35.,  32.,  21.,  26.,  42.,  33.,
     22.,  22.,  51.,  27.,  20.,  34.,  27.,  20.,  59.,
     34.,  47.,  22.,  29.,  32.,  74.,  55.,  63.,  26.,
     14.,  12.,  26.,  16.,   8.,  28.,   8.,  20.,  23.,
     12.,  14.,  19.,  86.,  20.,  31.,  22.,  45.,  10.,
     15.,  25.,  17.,   8.,  30.,  29.,  23.,  14.,  17.,
     28.,  23.,  40.,  12.,  19.,  16.,  24.,  23.,  47.,
     64.,  33.,  17.,  31.,  38.,  42.,  45.,  31.,  28.,
     15.,  33.,  48.,  45.,  17.,  58.,  54.,  15.,  32.,
     36.,  32.,  47.,  43.,  30.,  37.,  40.,  31.,  38.,
     30.,  26.,  16.,  33.,  50.,  33.,  86.,  34.,  26.,
     22.,  44.,  30.,  20.,  53.,  28.,  52.,  31.,  31.,
     26.,  14.,  34.,  28.,  29.,  70.,  19.,  32.,  22.,
     36.,  33.,  10.,  30.,  35.,  15.,  38.,  28.,  27.,
     22.,  13.,  16.,  18.,  18.,  12.,  20.,  25.,  14.,
     14.,  20.,  20.,  13.,  14.,  17.,  19.,  20.,  16.,
     15.,  25.,  11.,  29.,  16.,  15.,  10.,  12.,  13.,
     18.,  13.,  10.,  11.])

def main():
    points = sorted(set(changepoint.changepoint(data, confidence=99.)))
    print points
    print
    for i, a in zip(points, numpy.split(data, points)):
        if len(a) == 0:
            continue
        print i, "==>", a

    # find the next change point
    # from itertools import count
    # for c in count(int(data[-1] + 5)):
    #     m = numpy.append(data, c)
    #     p = sorted(set(changepoint.changepoint(m, confidence=99.)))
    #     if len(points) != len(p):
    #         print "!", c
    #         break
    #     else:
    #         print "#", c

if __name__ == "__main__":
    main()
